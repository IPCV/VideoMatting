Bootstrap: docker
From: python:3.12-slim

%labels
    Author Sergi Garcia Sarroca

%environment
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8
    export PYTHONUNBUFFERED=1
    export VIRTUAL_ENV=/opt/venv
    export PATH="$VIRTUAL_ENV/bin:$PATH"

%post
    # Update packages
    apt-get update && apt-get install -y \
        build-essential \
        git \
        curl \
        wget \
        ca-certificates \
        libgl1-mesa-glx \
        libglib2.0-0 \
        python3-venv \
        && rm -rf /var/lib/apt/lists/*

    # Upgrade pip
    pip install --upgrade pip

    # Create virtual environment
    python -m venv /opt/venv
    . /opt/venv/bin/activate

    # Install Python packages inside venv
    pip install --upgrade pip
    pip install torch torchvision torchaudio pims av einops
    pip install timm Pillow numpy matplotlib easing_functions tensorboard pandas codecarbon
    pip install mamba-ssm[causal-conv1d] --no-build-isolation

%runscript
    # Activate venv automatically when running the container
    source /opt/venv/bin/activate
    exec python "$@"
